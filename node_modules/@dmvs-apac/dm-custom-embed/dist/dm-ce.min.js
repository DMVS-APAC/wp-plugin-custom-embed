!function(t){var e={};function r(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(a,i,function(e){return t[e]}.bind(null,i));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);new(function(){function t(t){this.rootEls=null,this.playerParams=null,this.searchParams=null,this.videoParams=null,this.rootEls=t,this.addEventListeners(),this.registerNewEvents(),this.extractAttrs()}return t.prototype.addEventListeners=function(){var t=this;document.addEventListener("dm-api-ready",(function(e){t.loadDmPlayer()})),document.addEventListener("dm-player-extracted",(function(e){t.prepareSearchParams()})),document.addEventListener("dm-search-params-ready",(function(e){t.searchVideo()}))},t.prototype.registerNewEvents=function(){this.apiReady=new Event("dm-api-ready"),this.playerExtracted=new Event("dm-player-extracted"),this.searchParamsReady=new Event("dm-search-params-ready")},t.prototype.extractAttrs=function(){var t=this.rootEls[0];this.playerParams={maxWordSearch:t.getAttribute("maxWordSearch")?Number(t.getAttribute("maxWordSearch")):15,minWordLength:t.getAttribute("minWordLength")?Number(t.getAttribute("minWordLength")):4,minWordSearch:t.getAttribute("minWordSearch")?Number(t.getAttribute("minWordSearch")):2,language:t.getAttribute("language")?t.getAttribute("language"):"",sort:t.getAttribute("sort")?t.getAttribute("sort"):"recent",owners:t.getAttribute("owners")?t.getAttribute("owners"):"",category:t.getAttribute("category")?t.getAttribute("category"):"",excludeIds:t.getAttribute("excludeIds")?t.getAttribute("excludeIds"):"",searchInPlaylist:!!t.getAttribute("searchInPlaylist")&&t.getAttribute("searchInPlaylist"),syndication:t.getAttribute("syndication")?t.getAttribute("syndication"):"",autoPlayMute:"false"!=t.getAttribute("autoPlayMute"),queueEnable:"false"!=t.getAttribute("queueEnable"),queueEnableNext:"false"!=t.getAttribute("queueEnableNext"),controls:"false"!=t.getAttribute("controls"),adsParams:t.getAttribute("adsParams")?t.getAttribute("adsParams"):"contextual",cpeId:t.getAttribute("cpeId")?t.getAttribute("cpeId").split(","):[""],keywordsSelector:t.getAttribute("keywordsSelector")?t.getAttribute("keywordsSelector"):null},document.dispatchEvent(this.playerExtracted)},t.prototype.prepareSearchParams=function(){var t=this.findKeywords(this.playerParams.keywordsSelector);this.searchParams={fields:"id,title",limit:1,sort:this.playerParams.sort,search:t?t.sort((function(t,e){return e.length-t.length})).slice(0,this.playerParams.maxWordSearch).join(" "):"",language:this.playerParams.language?this.playerParams.language:""},this.playerParams.searchInPlaylist||(this.searchParams.private=0,this.searchParams.flags="no_live,exportable"+(this.playerParams.owners.length>0?"":",verified"),this.searchParams.longer_than=.35,this.playerParams.owners&&(this.searchParams.owners=this.playerParams.owners),this.playerParams.category&&(this.searchParams.channel=this.playerParams.category),this.playerParams.excludeIds&&(this.searchParams.exclude_ids=this.playerParams.excludeIds)),this.playerParams.language&&(this.searchParams.language=this.playerParams.language),document.dispatchEvent(this.searchParamsReady)},t.prototype.htmlEntities=function(t){return String(t).replace(/&/g,"%26").replace(/=/g,"%3d")},t.prototype.loadDmPlayer=function(){var t=this.rootEls[0],e=document.createElement("div"),r="";""===this.playerParams.adsParams?r+="ads_params=contextual":r+="ads_params="+this.htmlEntities(this.playerParams.adsParams),""!==this.playerParams.syndication&&(r+="&syndication="+this.playerParams.syndication),!0!==this.playerParams.controls&&(r+="&controls="+this.playerParams.controls),e.setAttribute("class","dailymotion-cpe"),e.setAttribute("video-id",this.videoParams.id),e.setAttribute("query-string",r),null!==t.getAttribute("width")&&(this.playerParams.width=Number(t.getAttribute("width")),e.setAttribute("width",t.getAttribute("width"))),null!==t.getAttribute("height")&&(this.playerParams.height=Number(t.getAttribute("height")),e.setAttribute("height",t.getAttribute("height")));var a=this.playerParams.cpeId[0];/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(a=this.playerParams.cpeId[1]?this.playerParams.cpeId[1]:this.playerParams.cpeId[0]);var i,s,n,o,l,c,u,d=new Date;t.appendChild(e),i=window,s=document,n="script",o="cpe",l=a,i.WDMObject=o,i[o]=i[o]||function(){(i[o].q=i[o].q||[]).push(arguments)},i[o].l=1*d,i[o].i=l,i[o].f=void 0,i[o].g=void 0,(c=s.createElement(n)).async=1,c.src="//api.dmcdn.net/pxl/cpe/client.min.js",(u=s.getElementsByTagName(n)[0]).parentNode.insertBefore(c,u)},t.prototype.setVideo=function(t){this.videoParams=t,document.dispatchEvent(this.apiReady)},t.prototype.searchVideo=function(){var t=this;console.log("%c DM related ","background: #56C7FF; color: #232323","Search: "+this.searchParams.search);var e=Object.entries(this.searchParams).map((function(t){var e=t[0],r=t[1];return encodeURIComponent(e)+"="+encodeURIComponent(r)})).join("&"),r="https://api.dailymotion.com/"+(this.playerParams.searchInPlaylist?"playlist/"+this.playerParams.searchInPlaylist+"/videos":"videos")+"?"+e;fetch(r).then((function(t){return t.json()})).then((function(e){e.total>0?t.setVideo(e.list[0]):(console.log("%c DM related ","background: #56C7FF; color: #232323","Can not find related video. Fallback video used."),t.getFallbackVideo())}))},t.prototype.getFallbackVideo=function(){var t=Math.floor(Date.now()/1e3),e="https://api.dailymotion.com/"+(this.playerParams.searchInPlaylist?"playlist/"+this.playerParams.searchInPlaylist+"/videos?":"videos?owners="+this.playerParams.owners)+"&created_after="+(t-2592e3)+"&sort=random&limit=1&fields=id,title",r=this;fetch(e).then((function(t){return t.json()})).then((function(t){t.list.length>0?r.setVideo(t.list[0]):console.warn("DM related Unable to find a fallback video")}))},t.prototype.findKeywords=function(t){var e=[""];if(null!==t){var r=document.querySelector(t);e=this.sanitizeKeywords(r.getAttribute("content"))}else null===t&&void 0!==document.getElementsByTagName("h1")[0]&&(e=this.sanitizeKeywords(document.getElementsByTagName("h1")[0].textContent));return e},t.prototype.sanitizeKeywords=function(t){var e=this;return t.replace(/[^- \u3131-\uD79D a-zA-Z0-9 \u00C0-\u00FF \u0900-\u097F \u0153]/g," ").split(" ").filter((function(t){return t.length>=e.playerParams.minWordLength}))},t}())(document.querySelectorAll(".dm-player"))}]);
//# sourceMappingURL=dm-ce.min.js.map