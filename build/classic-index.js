(()=>{"use strict";var e=[(e,t,n)=>{var s=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("unable to locate global object")}();e.exports=t=s.fetch,s.fetch&&(t.default=s.fetch.bind(s)),t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response}],t={};function n(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=window.wp.element;function t(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function s(e,n){return function(e,t){return t.get?t.get.call(e):t.value}(e,t(e,n,"get"))}function a(e,n,s){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,t(e,n,"set"),s),s}const i=window.wp.i18n,o=window.wp.data,r=window.wp.components,l=window.wp.apiFetch;var c=n.n(l);function d(e,t="GET",n){const s={path:e,method:t};return void 0!==n&&(s.data=n),new Promise((e=>{c()(s).then((t=>{e(t)}))}))}function u(t){const{contentData:n,currentPage:s,callback:a}=t;return 0===Object.entries(n).length||0===n.total||!1===n.has_more&&1===n.page?(0,e.createElement)(e.Fragment,null):1===n.page&&!0===n.has_more?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("button",{type:"button",className:"components-button button action dm__next-button",onClick:()=>a(s+1)},(0,i.__)("Next","textdomain"))):!1===n.has_more&&1!==n.page?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("button",{type:"button",className:"components-button button action dm__prev-button",onClick:()=>a(s-1)},(0,i.__)("Previous","textdomain"))):(0,e.createElement)(e.Fragment,null,(0,e.createElement)("button",{type:"button",className:"components-button button action dm__prev-button",onClick:()=>a(s-1)},(0,i.__)("Previous","textdomain")),(0,e.createElement)("button",{type:"button",className:"components-button button action dm__next-button",onClick:()=>a(s+1)},(0,i.__)("Next","textdomain")))}"undefined"==typeof window?n(0):window.fetch;const h="data/dm-sdk",m={connectionStatus:null},p={reducer:(e=m,t)=>"SET_CONNECTION_STATUS"===t.type?{connectionStatus:t.status}:e,actions:{setConnectionStatus:e=>({type:"SET_CONNECTION_STATUS",status:e})},selectors:{getConnectionStatus:e=>e.connectionStatus}},g=(0,o.createReduxStore)(h,p);(0,o.register)(g);const w="data/dm-video",y={id:"",private:!1,private_id:"",status:"",thumbnail_240_url:"",title:"",name:""},f={reducer:(e=y,t)=>"SET_VIDEO"===t.type?{videoData:t.videoData}:e,actions:{setVideo:e=>({type:"SET_VIDEO",videoData:e})},selectors:{getVideoData:e=>e.videoData}},b=(0,o.createReduxStore)(w,f);function v(e,t,n){var s,a,i;e=null!==(s=e)&&void 0!==s?s:"customEvent",t=null!==(a=t)&&void 0!==a?a:"index",n=null!==(i=n)&&void 0!==i?i:{};const o=new CustomEvent(e,{detail:{sender:t,customEventData:n},bubbles:!0,cancelable:!0});document.dispatchEvent(o)}function _(e,t,n){E(e,t),t.set(e,n)}function E(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(0,o.register)(b);var P=new WeakMap,k=new WeakMap,S=new WeakSet;class D extends e.Component{constructor(e){var t;super(e),E(this,t=S),t.add(this),_(this,P,{writable:!0,value:null}),_(this,k,{writable:!0,value:""}),this.state={videos:{},currentPage:1,loadingData:!0},a(this,k,function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}(this,S,x).call(this)),this.setVideos=this.setVideos.bind(this),this.loadPage=this.loadPage.bind(this),this.setLoadingData=this.setLoadingData.bind(this)}async fetchVideo(e=1,t){this.setLoadingData(!0);const n=await d("/dm/v1/userinfo"),a=await d("/dm/v1/get-custom-options/manual_embed_content"),i={fields:"id,title,thumbnail_240_url,status,private,private_id",limit:this.props.perPage?this.props.perPage:10,flags:"no_live,exportable,verified",page:e};t?(i.sort="relevance",i.search=t):i.sort="recent";let o="";const r=void 0!==a.owners;return s(this,P)&&!0!==this.props.globalVideo&&!r?o="user/"+n.channel+"/videos":r&&!0!==this.props.globalVideo?(i.owners=a.owners,o="videos"):o="videos",new Promise((async e=>{DM.api(o,"get",i,(t=>{this.setLoadingData(!1),e(t)}),!0)})).catch((e=>{console.log(e)}))}setVideos(e){this.setState({videos:e})}setCurrentPage(e=1){this.setState({currentPage:e})}setLoadingData(e){this.setState({loadingData:e})}async addToPost(e){if("gutenberg"===s(this,k))(0,o.dispatch)(w).setVideo(e),v("dm-video-updated","dm-video-component");else{let t="";!0===e.private?t+=' privatevideoid="'+e.private_id+'"':t+=' videoid="'+e.id+'"',wp.media.editor.insert("[dm-player"+t+"]")}}async componentDidMount(){a(this,P,(0,o.select)(h).getConnectionStatus().connectionStatus);const e=await this.fetchVideo();this.setVideos(e)}async componentDidUpdate(e){if(this.props.keywords!==e.keywords||this.props.globalVideo!==e.globalVideo){const e=await this.fetchVideo(1,this.props.keywords);this.setCurrentPage(),this.setVideos(e)}}async loadPage(e){const t=await this.fetchVideo(e,this.props.keywords);this.setCurrentPage(e),this.setVideos(t)}renderVideoList(){const t=[];if(void 0!==this.state.videos.error)return(0,e.createElement)("li",{className:"dm__show-message"},"API errors, please check your settings…");if(!(void 0!==this.state.videos&&Object.entries(this.state.videos).length>0&&this.state.videos.list.length>0))return(0,e.createElement)("li",null,"No video found…");{const n=this.state.videos.list;for(let s=0;s<n.length;s++)t.push((0,e.createElement)("li",{key:n[s],className:`content__item ${n[s].private?"private":""} ${"ready"===n[s].status?"draft":""}`},(0,e.createElement)("button",{onClick:()=>this.addToPost(n[s]),type:"button"},(0,e.createElement)("figure",{className:"content__image-wrapper"},(0,e.createElement)("div",{className:"content__placement"},(0,e.createElement)("img",{src:n[s].thumbnail_240_url,alt:n[s].title,className:"content__thumbnail"}))),(0,e.createElement)("span",{className:"content__title",title:n[s].title},n[s].title))))}return t}render(){return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("ul",{className:"dm__search-results"},this.state.loadingData?(0,e.createElement)("li",null,(0,i.__)("loading video…","textdomain")):this.renderVideoList()),(0,e.createElement)(u,{currentPage:this.state.currentPage,callback:this.loadPage,contentData:this.state.videos}))}}function x(){return document.body.classList.contains("block-editor-page")?"gutenberg":"classic-editor"}function C(e,t,n){N(e,t),t.set(e,n)}function N(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}var V=new WeakMap,T=new WeakMap,F=new WeakSet;class M extends e.Component{constructor(e){var t;super(e),N(this,t=F),t.add(this),C(this,V,{writable:!0,value:null}),C(this,T,{writable:!0,value:""}),this.state={playlists:{},currentPage:1,loadingData:!0},a(this,T,function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}(this,F,L).call(this)),this.setPlaylist=this.setPlaylist.bind(this),this.loadPage=this.loadPage.bind(this),this.setLoadingData=this.setLoadingData.bind(this)}async addToPost(e){if("gutenberg"===s(this,T))(0,o.dispatch)(w).setVideo(e),v("dm-video-updated","dm-video-updated");else{let t="";t+=' playlistid="'+e.id+'"',wp.media.editor.insert("[dm-player"+t+"]")}}async fetchPlaylist(e=1,t){this.setLoadingData(!0);const n=await d("/dm/v1/userinfo"),a=await d("/dm/v1/get-custom-options/manual_embed_content"),i={limit:this.props.perPage?this.props.perPage:10,fields:"id,name,thumbnail_240_url,private",page:e,sort:"recent",flags:"verified"};if(t&&(i.search=t,i.sort="relevance"),s(this,V)&&!0!==this.props.globalVideo)i.owner=n.channel;else if(!s(this,V)&&0!==a.length){const e=a.owners.split(",");i.owner=e[0]}return new Promise((e=>{DM.api("/playlists","get",i,(t=>{this.setLoadingData(!1),e(t)}),!0)})).catch((e=>{console.log(e)}))}async loadPage(e){const t=await this.fetchPlaylist(e,this.props.keywords);this.setCurrentPage(e),this.setPlaylist(t)}async componentDidMount(){a(this,V,(0,o.select)(h).getConnectionStatus().connectionStatus);const e=await this.fetchPlaylist();this.setCurrentPage(),this.setPlaylist(e)}async componentDidUpdate(e){if(this.props.keywords!==e.keywords||this.props.globalVideo!==e.globalVideo){const e=await this.fetchPlaylist(1,this.props.keywords);this.setCurrentPage(1),this.setPlaylist(e)}}setLoadingData(e){this.setState({loadingData:e})}setPlaylist(e){this.setState({playlists:e})}setCurrentPage(e=1){this.setState({currentPage:e})}renderPlaylists(){const t=[];if(void 0!==this.state.playlists.error)return(0,e.createElement)("li",{className:"dm__show-message"},"API errors, to search playlist you must login first…");if(!(void 0!==this.state.playlists&&Object.entries(this.state.playlists).length>0&&this.state.playlists.list.length>0))return(0,e.createElement)("li",null,"No playlist found…");{const n=this.state.playlists.list;for(let s=0;s<n.length;s++)t.push((0,e.createElement)("li",{key:n[s],className:"content__item"},(0,e.createElement)("button",{onClick:()=>this.addToPost(n[s])},(0,e.createElement)("figure",{className:"content__image-wrapper"},(0,e.createElement)("div",{className:"content__placement"},(0,e.createElement)("img",{src:n[s].thumbnail_240_url,alt:n[s].name,className:"content__thumbnail"}))),(0,e.createElement)("span",{className:"content__title"},n[s].name))))}return t}render(){return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("ul",{className:"dm__search-results"},this.state.loadingData?(0,e.createElement)("li",null,(0,i.__)("loading playlist…","textdomain")):this.renderPlaylists()),(0,e.createElement)(u,{currentPage:this.state.currentPage,callback:this.loadPage,contentData:this.state.playlists}))}}function L(){return document.body.classList.contains("block-editor-page")?"gutenberg":"classic-editor"}var j=new WeakMap;class I extends e.Component{constructor(e){var t,n,s;super(e),s={writable:!0,value:null},function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t=this,n=j),n.set(t,s),this.state={playlists:{},keywords:"",currentPage:1,findGlobal:!1,findPlaylist:!1},this.findVideo=this.findVideo.bind(this),this.setKeywords=this.setKeywords.bind(this),this.setGlobalVideo=this.setGlobalVideo.bind(this),this.setFindPlaylist=this.setFindPlaylist.bind(this)}async setConnectionStatus(t){let n;n=t?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("span",{className:"dm--connected"})," ",(0,i.__)("You're connected","textdomain")):(0,e.createElement)(e.Fragment,null,(0,e.createElement)("span",{className:"dm--disconnected"})," ",(0,i.__)("You're not connected","textdomain")),this.setState({connectionStatus:n})}componentDidMount(){a(this,j,(0,o.select)(h).getConnectionStatus().connectionStatus),this.setConnectionStatus(s(this,j))}async findVideo(e){e.preventDefault()}setKeywords(e){this.setState({keywords:e.target.value})}setGlobalVideo(e){this.setState({findGlobal:!0===e.target.checked})}setFindPlaylist(e){this.setState({findPlaylist:!0===e.target.checked})}render(){return(0,e.createElement)(r.PanelBody,null,(0,e.createElement)("div",{className:"dm__content-list"},(0,e.createElement)("p",null,this.state.connectionStatus),(0,e.createElement)("form",{onSubmit:this.findVideo},(0,e.createElement)("label",{htmlFor:"keywords"},(0,i.__)("Find a video","textdomain")),(0,e.createElement)("input",{id:"keywords",onChange:this.setKeywords,type:"text",name:"keywords",className:"dm__keywords-input"}),(0,e.createElement)("button",{type:"submit",className:"action button"},"Find"),(0,e.createElement)("label",{htmlFor:"global-video",className:"checkbox-label"},(0,e.createElement)("input",{type:"checkbox",id:"global-video",onChange:this.setGlobalVideo,name:"globalVideo",value:"1"})," ",(0,i.__)("Find global","textdomain")),(0,e.createElement)("label",{htmlFor:"find-playlist",className:"checkbox-label"},(0,e.createElement)("input",{type:"checkbox",id:"find-playlist",onChange:this.setFindPlaylist,name:"findPlaylist",value:"1"})," ",(0,i.__)("Find playlist","textdomain"))),this.state.findPlaylist?(0,e.createElement)(M,{keywords:this.state.keywords,globalVideo:this.state.findGlobal,perPage:this.props.resultsPerPage}):(0,e.createElement)(D,{keywords:this.state.keywords,globalVideo:this.state.findGlobal,perPage:this.props.resultsPerPage})))}}function O(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function W(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var G=new WeakSet,R=new WeakSet,z=new WeakSet,B=new WeakSet,A=new WeakSet;function K(){DM._oauth.tokenUrl="https://api.dailymotion.com/oauth/token",DM.Auth.isSessionExpired=(e,t)=>(void 0===e&&(e=DM._session),!e||!(e&&"expires_in"in e&&(new Date).getTime()<1e3*parseInt(e.expires_in,10))&&(delete e.expires_in,!0))}async function U(){const e=await d("/dm/v1/get-api-key");DM.init({apiKey:e.api_key,apiSecret:e.api_secret,status:!0,cookie:!0})}function q(){DM.Event.subscribe("auth.sessionChange",(e=>{if("connected"===e?.status){let t=e.session;"expires_in"in e.session||(t.expires_in=t.expires),t.expires=t.expires+2419200,DM.Cookie.set(t)}}))}function H(){return new Promise((e=>{DM.getLoginStatus((t=>{t.session?e(!0):e(!1)}))}))}async function Y(){const e=await W(this,B,H).call(this);(0,o.dispatch)(h).setConnectionStatus({connectionStatus:e});const t=new CustomEvent("dm-sdk-ready");document.dispatchEvent(t)}window.wp["components/buildStyle/style.css"];const $=()=>{const[t,n]=(0,e.useState)(!1);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(r.Button,{className:"button",id:"insert-dailymotion",type:"button",onClick:()=>n(!0)},(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"img","aria-hidden":"true",focusable:"false",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)("path",{className:"path",d:"m12.1479 18.5957c-2.4949 0-4.28131-1.7558-4.28131-4.0658 0-2.2176 1.78641-4.0965 4.09651-4.0965 2.2793 0 4.0349 1.7864 4.0349 4.1581 0 2.2794-1.7556 4.0042-3.8501 4.0042zm8.3521-18.5957-4.5329 1v7c-1.1088-1.41691-2.8028-1.8787-4.8049-1.8787-2.09443 0-3.97329.76993-5.5133 2.27917-1.72483 1.66323-2.6489 3.78863-2.6489 6.16033 0 2.5873.98562 4.8049 2.89526 6.499 1.44763 1.2936 3.17251 1.9402 5.17454 1.9402 1.9713 0 3.4498-.5236 4.8973-1.9402v1.9402h4.5329c0-7.6359 0-15.3641 0-23z",fill:"#2271b1"})),"Dailymotion"),t&&(0,e.createElement)(r.Modal,{className:"popup__content-finder",title:"Find a Video",onRequestClose:()=>n(!1)},(0,e.createElement)(I,{resultsPerPage:12})))};document.addEventListener("dm-sdk-ready",(()=>{const t=document.getElementById("wp-content-editor-tools"),n=document.createElement("span");n.id="dm-search-classic",t.appendChild(n),(0,e.render)((0,e.createElement)($),document.getElementById("dm-search-classic"))})),new class{constructor(){O(this,A),O(this,B),O(this,z),O(this,R),O(this,G),this.setupDm()}async setupDm(){await async function(e=(()=>Boolean),t=50,n=1/0,s=""){return new Promise(((a,i)=>{let o=0;const r=setInterval((()=>{const l=e(),c=o>n||l;o+=t,l?(a(""),clearInterval(r)):c&&(i(new Error("waitFor(): "+s)),clearInterval(r))}),t)}))}((()=>"undefined"!=typeof DM),100,3e4,"Timeout waiting for DM loaded, please refresh and make sure your internet is active"),W(this,G,K).call(this),await W(this,R,U).call(this),W(this,z,q).call(this),await W(this,A,Y).call(this)}}})()})();