!function(){"use strict";var t={300:function(t,e){var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();t.exports=e=n.fetch,n.fetch&&(e.default=n.fetch.bind(n)),e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var a=e[s]={exports:{}};return t[s](a,a.exports,n),a.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){var t=window.wp.element;function e(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function s(t,n){return function(t,e){return e.get?e.get.call(t):e.value}(t,e(t,n,"get"))}function i(t,n,s){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,e(t,n,"set"),s),s}var a=window.wp.i18n,o=window.wp.data,l=window.wp.components,r=window.wp.apiFetch,c=n.n(r);function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2?arguments[2]:void 0;const s={path:t,method:e};return void 0!==n&&(s.data=n),new Promise((t=>{c()(s).then((e=>{t(e)}))}))}function h(e){const{contentData:n,currentPage:s,callback:i}=e;return 0===Object.entries(n).length||0===n.total||!1===n.has_more&&1===n.page?(0,t.createElement)(t.Fragment,null):1===n.page&&!0===n.has_more?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("button",{type:"button",className:"components-button button action dm__next-button",onClick:()=>i(s+1)},(0,a.__)("Next","textdomain"))):!1===n.has_more&&1!==n.page?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("button",{type:"button",className:"components-button button action dm__prev-button",onClick:()=>i(s-1)},(0,a.__)("Previous","textdomain"))):(0,t.createElement)(t.Fragment,null,(0,t.createElement)("button",{type:"button",className:"components-button button action dm__prev-button",onClick:()=>i(s-1)},(0,a.__)("Previous","textdomain")),(0,t.createElement)("button",{type:"button",className:"components-button button action dm__next-button",onClick:()=>i(s+1)},(0,a.__)("Next","textdomain")))}"undefined"==typeof window?n(300):window.fetch;const u="data/dm-sdk",m={connectionStatus:null},p={reducer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,e=arguments.length>1?arguments[1]:void 0;return"SET_CONNECTION_STATUS"===e.type?{connectionStatus:e.status}:t},actions:{setConnectionStatus:t=>({type:"SET_CONNECTION_STATUS",status:t})},selectors:{getConnectionStatus:t=>t.connectionStatus}},g=(0,o.createReduxStore)(u,p);function w(t,e,n){f(t,e),e.set(t,n)}function f(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(0,o.register)(g);var y=new WeakMap,v=new WeakMap,b=new WeakSet;class _ extends t.Component{constructor(t){var e;super(t),f(this,e=b),e.add(this),w(this,y,{writable:!0,value:null}),w(this,v,{writable:!0,value:""}),this.state={videos:{},currentPage:1,loadingData:!0},i(this,v,function(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}(this,b,E).call(this)),this.setVideos=this.setVideos.bind(this),this.loadPage=this.loadPage.bind(this),this.setLoadingData=this.setLoadingData.bind(this)}async fetchVideo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0;this.setLoadingData(!0);const n=await d("/dm/v1/userinfo"),i=await d("/dm/v1/get-custom-options/content"),a={fields:"id,title,thumbnail_240_url,status,private,private_id",limit:this.props.perPage?this.props.perPage:10,flags:"no_live,exportable,verified",page:t};e?(a.sort="relevance",a.search=e):a.sort="recent";let o="";const l=void 0!==i.owners;return s(this,y)&&!0!==this.props.globalVideo&&!l?o="user/"+n+"/videos":l&&!0!==this.props.globalVideo?(a.owners=i.owners,o="videos"):o="videos",new Promise((async t=>{DM.api(o,a,(e=>{this.setLoadingData(!1),t(e)}))})).catch((t=>{console.log(t)}))}setVideos(t){this.setState({videos:t})}setCurrentPage(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.setState({currentPage:t})}setLoadingData(t){this.setState({loadingData:t})}async addToPost(t){if("gutenberg"===s(this,v)){(0,o.dispatch)("core/editor").editPost({meta:{_dm_video_data:JSON.stringify(t)}});const e=new CustomEvent("dm-video-updated");document.dispatchEvent(e)}else{let e="";!0===t.private?e+=' privatevideoid="'+t.private_id+'"':e+=' videoid="'+t.id+'"',wp.media.editor.insert("[dm-player"+e+"]")}}async componentDidMount(){i(this,y,(0,o.select)(u).getConnectionStatus().connectionStatus);const t=await this.fetchVideo();this.setVideos(t)}async componentDidUpdate(t){if(this.props.keywords!==t.keywords||this.props.globalVideo!==t.globalVideo){const t=await this.fetchVideo(1,this.props.keywords);this.setCurrentPage(),this.setVideos(t)}}async loadPage(t){const e=await this.fetchVideo(t,this.props.keywords);this.setCurrentPage(t),this.setVideos(e)}renderVideoList(){const e=[];if(void 0!==this.state.videos.error)return(0,t.createElement)("li",{className:"dm__show-message"},"API errors, please check your settings…");if(!(void 0!==this.state.videos&&Object.entries(this.state.videos).length>0&&this.state.videos.list.length>0))return(0,t.createElement)("li",null,"No video found…");{const n=this.state.videos.list;for(let s=0;s<n.length;s++)e.push((0,t.createElement)("li",{key:n[s],className:`content__item ${n[s].private?"private":""} ${"ready"===n[s].status?"draft":""}`},(0,t.createElement)("button",{onClick:()=>this.addToPost(n[s]),type:"button"},(0,t.createElement)("figure",{className:"content__image-wrapper"},(0,t.createElement)("div",{className:"content__placement"},(0,t.createElement)("img",{src:n[s].thumbnail_240_url,alt:n[s].title,className:"content__thumbnail"}))),(0,t.createElement)("span",{className:"content__title",title:n[s].title},n[s].title))))}return e}render(){return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("ul",{className:"dm__search-results"},this.state.loadingData?(0,t.createElement)("li",null,(0,a.__)("loading video…","textdomain")):this.renderVideoList()),(0,t.createElement)(h,{currentPage:this.state.currentPage,callback:this.loadPage,contentData:this.state.videos}))}}function E(){return document.body.classList.contains("block-editor-page")?"gutenberg":"classic-editor"}function P(t,e,n){k(t,e),e.set(t,n)}function k(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}var S=new WeakMap,C=new WeakMap,x=new WeakSet;class D extends t.Component{constructor(t){var e;super(t),k(this,e=x),e.add(this),P(this,S,{writable:!0,value:null}),P(this,C,{writable:!0,value:""}),this.state={playlists:{},currentPage:1,loadingData:!0},i(this,C,function(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}(this,x,N).call(this)),this.setPlaylist=this.setPlaylist.bind(this),this.loadPage=this.loadPage.bind(this),this.setLoadingData=this.setLoadingData.bind(this)}async addToPost(t){if("gutenberg"===s(this,C)){(0,o.dispatch)("core/editor").editPost({meta:{_dm_video_data:JSON.stringify(t)}});const e=new CustomEvent("dm-video-updated");document.dispatchEvent(e)}else{let e="";e+=' playlistid="'+t.id+'"',wp.media.editor.insert("[dm-player"+e+"]")}}async fetchPlaylist(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0;this.setLoadingData(!0);const n=await d("/dm/v1/userinfo"),i=await d("/dm/v1/get-custom-options/content"),a={limit:this.props.perPage?this.props.perPage:10,fields:"id,name,thumbnail_240_url,private",page:t,sort:"recent",flags:"verified"};if(e&&(a.search=e,a.sort="relevance"),s(this,S)&&!0!==this.props.globalVideo)a.owner=n;else if(!s(this,S)&&!1!==i){const t=i.owners.split(",");a.owner=t[0]}return new Promise((t=>{DM.api("/playlists",a,(e=>{this.setLoadingData(!1),t(e)}))})).catch((t=>{console.log(t)}))}async loadPage(t){const e=await this.fetchPlaylist(t,this.props.keywords);this.setCurrentPage(t),this.setPlaylist(e)}async componentDidMount(){i(this,S,(0,o.select)(u).getConnectionStatus().connectionStatus);const t=await this.fetchPlaylist();this.setCurrentPage(),this.setPlaylist(t)}async componentDidUpdate(t){if(this.props.keywords!==t.keywords||this.props.globalVideo!==t.globalVideo){const t=await this.fetchPlaylist(1,this.props.keywords);this.setCurrentPage(1),this.setPlaylist(t)}}setLoadingData(t){this.setState({loadingData:t})}setPlaylist(t){this.setState({playlists:t})}setCurrentPage(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.setState({currentPage:t})}renderPlaylists(){const e=[];if(void 0!==this.state.playlists.error)return(0,t.createElement)("li",{className:"dm__show-message"},"API errors, to search playlist you must login first…");if(!(void 0!==this.state.playlists&&Object.entries(this.state.playlists).length>0&&this.state.playlists.list.length>0))return(0,t.createElement)("li",null,"No playlist found…");{const n=this.state.playlists.list;for(let s=0;s<n.length;s++)e.push((0,t.createElement)("li",{key:n[s],className:"content__item"},(0,t.createElement)("button",{onClick:()=>this.addToPost(n[s])},(0,t.createElement)("figure",{className:"content__image-wrapper"},(0,t.createElement)("div",{className:"content__placement"},(0,t.createElement)("img",{src:n[s].thumbnail_240_url,alt:n[s].name,className:"content__thumbnail"}))),(0,t.createElement)("span",{className:"content__title"},n[s].name))))}return e}render(){return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("ul",{className:"dm__search-results"},this.state.loadingData?(0,t.createElement)("li",null,(0,a.__)("loading playlist…","textdomain")):this.renderPlaylists()),(0,t.createElement)(h,{currentPage:this.state.currentPage,callback:this.loadPage,contentData:this.state.playlists}))}}function N(){return document.body.classList.contains("block-editor-page")?"gutenberg":"classic-editor"}var V=new WeakMap;class T extends t.Component{constructor(t){var e,n,s;super(t),s={writable:!0,value:null},function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e=this,n=V),n.set(e,s),this.state={playlists:{},keywords:"",currentPage:1,findGlobal:!1,findPlaylist:!1},this.findVideo=this.findVideo.bind(this),this.setKeywords=this.setKeywords.bind(this),this.setGlobalVideo=this.setGlobalVideo.bind(this),this.setFindPlaylist=this.setFindPlaylist.bind(this)}async setConnectionStatus(e){let n;n=e?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("span",{className:"dm--connected"})," ",(0,a.__)("You're connected","textdomain")):(0,t.createElement)(t.Fragment,null,(0,t.createElement)("span",{className:"dm--disconnected"})," ",(0,a.__)("You're not connected","textdomain")),this.setState({connectionStatus:n})}componentDidMount(){i(this,V,(0,o.select)(u).getConnectionStatus().connectionStatus),this.setConnectionStatus(s(this,V))}async findVideo(t){t.preventDefault()}setKeywords(t){this.setState({keywords:t.target.value})}setGlobalVideo(t){this.setState({findGlobal:!0===t.target.checked})}setFindPlaylist(t){this.setState({findPlaylist:!0===t.target.checked})}render(){return(0,t.createElement)(l.PanelBody,null,(0,t.createElement)("div",{className:"dm__content-list"},(0,t.createElement)("p",null,this.state.connectionStatus),(0,t.createElement)("form",{onSubmit:this.findVideo},(0,t.createElement)("label",{htmlFor:"keywords"},(0,a.__)("Find a video","textdomain")),(0,t.createElement)("input",{id:"keywords",onChange:this.setKeywords,type:"text",name:"keywords",className:"dm__keywords-input"}),(0,t.createElement)("button",{type:"submit",className:"action button"},"Find"),(0,t.createElement)("label",{htmlFor:"global-video",className:"checkbox-label"},(0,t.createElement)("input",{type:"checkbox",id:"global-video",onChange:this.setGlobalVideo,name:"globalVideo",value:"1"})," ",(0,a.__)("Find global","textdomain")),(0,t.createElement)("label",{htmlFor:"find-playlist",className:"checkbox-label"},(0,t.createElement)("input",{type:"checkbox",id:"find-playlist",onChange:this.setFindPlaylist,name:"findPlaylist",value:"1"})," ",(0,a.__)("Find playlist","textdomain"))),this.state.findPlaylist?(0,t.createElement)(D,{keywords:this.state.keywords,globalVideo:this.state.findGlobal,perPage:this.props.resultsPerPage}):(0,t.createElement)(_,{keywords:this.state.keywords,globalVideo:this.state.findGlobal,perPage:this.props.resultsPerPage})))}}function F(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function M(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}var L=new WeakSet,O=new WeakSet,W=new WeakSet,j=new WeakSet,I=new WeakSet;function G(){DM._oauth.tokenUrl="https://api.dailymotion.com/oauth/token",DM.Auth.isSessionExpired=(t,e)=>(void 0===t&&(t=DM._session),!t||!(t&&"expires_in"in t&&(new Date).getTime()<1e3*parseInt(t.expires_in,10))&&(delete t.expires_in,!0))}async function z(){const t=await d("/dm/v1/get-api-key");DM.init({apiKey:t.api_key,apiSecret:t.api_secret,status:!0,cookie:!0})}function B(){DM.Event.subscribe("auth.sessionChange",(t=>{if("connected"===(null==t?void 0:t.status)){let e=t.session;"expires_in"in t.session||(e.expires_in=e.expires),e.expires=e.expires+2419200,DM.Cookie.set(e)}}))}function R(){return new Promise((t=>{DM.getLoginStatus((e=>{e.session?t(!0):t(!1)}))}))}async function A(){const t=await M(this,j,R).call(this);(0,o.dispatch)(u).setConnectionStatus({connectionStatus:t});const e=new CustomEvent("dm-sdk-ready");document.dispatchEvent(e)}window.wp["components/buildStyle/style.css"];const K=()=>{const[e,n]=(0,t.useState)(!1);return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.Button,{className:"button",id:"insert-dailymotion",type:"button",onClick:()=>n(!0)},(0,t.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"img","aria-hidden":"true",focusable:"false",xmlns:"http://www.w3.org/2000/svg"},(0,t.createElement)("path",{className:"path",d:"m12.1479 18.5957c-2.4949 0-4.28131-1.7558-4.28131-4.0658 0-2.2176 1.78641-4.0965 4.09651-4.0965 2.2793 0 4.0349 1.7864 4.0349 4.1581 0 2.2794-1.7556 4.0042-3.8501 4.0042zm8.3521-18.5957-4.5329 1v7c-1.1088-1.41691-2.8028-1.8787-4.8049-1.8787-2.09443 0-3.97329.76993-5.5133 2.27917-1.72483 1.66323-2.6489 3.78863-2.6489 6.16033 0 2.5873.98562 4.8049 2.89526 6.499 1.44763 1.2936 3.17251 1.9402 5.17454 1.9402 1.9713 0 3.4498-.5236 4.8973-1.9402v1.9402h4.5329c0-7.6359 0-15.3641 0-23z",fill:"#2271b1"})),"Dailymotion"),e&&(0,t.createElement)(l.Modal,{className:"popup__content-finder",title:"Find a Video",onRequestClose:()=>n(!1)},(0,t.createElement)(T,{resultsPerPage:12})))};document.addEventListener("dm-sdk-ready",(()=>{const e=document.getElementById("wp-content-editor-tools"),n=document.createElement("span");n.id="dm-search-classic",e.appendChild(n),(0,t.render)((0,t.createElement)(K),document.getElementById("dm-search-classic"))})),new class{constructor(){F(this,I),F(this,j),F(this,W),F(this,O),F(this,L),this.setupDm()}async setupDm(){await async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>Boolean,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((i,a)=>{let o=0;const l=setInterval((()=>{const r=t(),c=o>n||r;o+=e,r?(i(""),clearInterval(l)):c&&(a(new Error("waitFor(): "+s)),clearInterval(l))}),e)}))}((()=>"undefined"!=typeof DM),100,3e4,"Timeout waiting for DM loaded, please refresh and make sure your internet is active"),M(this,L,G).call(this),await M(this,O,z).call(this),M(this,W,B).call(this),await M(this,I,A).call(this)}}}()}();